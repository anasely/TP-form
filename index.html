<!DOCTYPE html>
<html>

<head>
  <title>Affichage des données depuis Google Sheet</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">


</head>

<body>


  <div class="py-5 bg-success fs-2 text-white text-center">
    <p class="my-5">Donner collecte à partir du formulaire Google</p>
  </div>

  <div class="container mt-5">
    <div id="data-container" class="row"></div>
  </div>

  <script>
    // Remplacez par l'URL de votre Google Sheet
    const sheetURL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTBMKiNDRK0N4MoWCQa5oAsy9XW-WhVM4QYZB1mF3Cyn8xQtQpzW7DvRU0ljL3apr0ZaRSrrkCONskh/pub?output=csv';

    function getGoogleDriveFileID(url) {
      const match = url.match(/id=([a-zA-Z0-9-_]+)/);
      console.log(url)
      return match ? match[1] : null;
    }

    // Fetch data from Google Sheet
    fetch(sheetURL)
      .then(response => response.text())
      .then(data => {
        // Split the data into rows
        const rows = data.split('\n');
        const container = document.getElementById('data-container');

        // Iterate through each row (excluding the header)
        for (let i = 1; i < rows.length; i++) {
          const columns = rows[i].split(',');

          // Assuming the columns are in this order: nom, prenom, photo, heure
          const Nom = columns[1];
          const mail = columns[2];
          const film = columns[3]
          const photo = columns[4]; // Lien vers la photo sur Google Drive
          const imgId = photo.match(/id=([a-zA-Z0-9-_]+)/)[1]
          // Skip the 'heure' column (columns[0])

          // Créez un élément d'image et définissez l'attribut 'src' sur le lien correct pour Google Drive
          const img = document.createElement('img');
          img.className = 'text-center img-fluid mx-auto';
          img.src = `https://drive.google.com/uc?export=view&id=${imgId}`;
          img.alt = 'Photos';


          // Create a div with class "col-4"
          const divCol4 = document.createElement('div');
          divCol4.className = 'border p-3 rounded';

          const nomP = document.createElement('p');
          nomP.className = `fs-3 text-center`;
          nomP.innerHTML = `${Nom}`;

          const emailP = document.createElement('p');
          emailP.innerHTML = `Email: ${mail}`;

          const filmP = document.createElement('p');
          filmP.innerHTML = `Film prefere est: ${film}`;

          divCol4.appendChild(img);
          divCol4.appendChild(nomP);
          divCol4.appendChild(emailP);
          divCol4.appendChild(filmP);

          const divWrapper = document.createElement('div');
          divWrapper.className = 'col-4';

          divWrapper.appendChild(divCol4);
          container.appendChild(divWrapper);

        }
      })
      .catch(error => {
        console.error('Error fetching data:', error);
      });

    // Fonction pour extraire l'ID du fichier Google Drive depuis le lien
    function getGoogleDriveFileID(url) {
      const match = url.match(/\/d\/([a-zA-Z0-9_-]+)(?:\/|$)/);
      return match ? match[1] : null;
    }
  </script>
</body>

</html>
